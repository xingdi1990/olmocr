We are now ready to prove Theorem  $1.3$ .

*Proof of Theorem 1.3.* Let  $X \subseteq V(G)$  be a subset given by Lemma 2.4. We pass on to  $\Gamma = G[X]$ . The graph  $\Gamma$  has  $N \geq \alpha n/128$  vertices, and for  $\beta = \alpha n/(8N)$  and  $d = t/4$ , the following holds:

- (i)  $\Gamma$  is a  $(\beta, d)$ -expander, and
- (ii) for every partition  $V(\Gamma) = R \cup A \cup B$  with  $|R| \leq \alpha N/16$  and  $|A|, |B| \geq \beta N/4$ , there is an edge in  $\Gamma$  between A and B.

Let  $K = 25/\alpha^2$  (the constant in the upper bound on the size of T in Lemma 3.3). Consider the family  $\mathcal{P}$  of all ordered partitions  $V(\Gamma) = D \cup \left(\bigcup_{i=1}^k W_i\right) \cup U$ , where  $k \geq 0$  (this can be a different number for different partitions), such that the following holds:

- (P1) For every  $i \in [k]$ :  $|W_i| = \sqrt{\frac{2KN \log N}{d}} =: \ell$  and  $\Gamma[W_i]$  is connected,
- (P2) for every two distinct  $i, i' \in [k]$ , there is an edge in  $\Gamma$  between  $W_i$  and  $W_{i'}$ , and
- (P3)  $|D| \leq \alpha N/(32d)$  and  $|N_{\Gamma}(D) \cap U| < d|D|/2$ .

The first two properties imply that  $K_k$  is a minor of  $\Gamma$ .

By taking  $D = \emptyset$ ,  $k = 0$  and  $U = V(\Gamma)$ , we have that  $\mathcal{P}$  is not empty. Consider a partition  $V(\Gamma) = D \cup \left(\bigcup_{i=1}^k W_i\right) \cup U$  in  $\mathcal{P}$  which maximises  $|D|$ , tie-breaking by taking one which further maximises  $k$ . We prove that then necessarily

$$k \ge \frac{\alpha N}{64\ell} =: q.$$

As  $q = \Theta(\sqrt{nt/\log n})$ , this establishes the theorem. Suppose, towards a contradiction, that this is note the case. That is,  $k < q$ . Then

$$|W| = \left| \bigcup_{i=1}^{k} W_i \right| < \alpha N/64,$$

from which we conclude  $|U| \geq N/2$ , with room to spare.

The property  $(P3)$  in the proof of Theorem 1.4 is identical to the one used here, and the only property of W used in the proof of Claim 3.1 and Claim 3.2 is the upper bound on  $|W|$ , which is identical to the one used here. Therefore, same as in the proof of Theorem 1.4, the following holds:

- For every  $i \in [k]$  we have  $|N_{\Gamma}(W_i) \cap U| \ge d|W_i|/2$ , and
- $\Gamma[U]$  is a connected  $(\beta/2, d/2)$ -expander.

Now we can finish the proof using Lemma 3.3. For each  $i \in [k]$ , set  $U_i = N_{\Gamma}(W_i) \cap U$ . Then  $|U_i| \ge d\ell/2 =: s$ . For  $k < i \le q$ , take  $U_i \subseteq U$  to be an arbitrary set of size s. Apply Lemma 3.3 with sets  $U_1,\ldots,U_q$ , which we indeed can do as  $qs > 2|U|$  and  $|U|/s > \log |U|$ , where the former follows from  $d \ge t_0(\alpha)/4$  and the latter follows from  $d \le \sqrt{n}$ . We obtain a subset  $T \subseteq U$  of size

$$|T| \le K \frac{|U|}{s} \log \left(\frac{qs}{|U|}\right) \cdot \frac{\log |U|}{\log d} \le \ell,$$