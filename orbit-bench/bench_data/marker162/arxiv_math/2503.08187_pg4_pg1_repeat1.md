where a > 0. The FWI problem in equation 7 ensures that the estimated model, while satisfying the data (and the wave equation), is smooth along the direction 0.

Figure 1, top row, shows the anisotropic regularization balls for only one term of the regularizer equation 4 and for different values of [0]; = o and [0]; = 0. We observe that for = 0.5, the anisotropic regularization becomes equivalent to the standard isotropic regularization. When the value of o increases, reaching the maximum considered value of 0.9, the degree of regularization applied in the direction 0 and its normal is maximally different, resulting in a needle-shaped ellipse. This shape favors models with elongated features aligned with 0, while allowing variations in the normal direction to it, as illustrated in the bottom row.

## Algorithm 3

The augmented Lagrangian function of equation 7 is

$$\begin{aligned} \mathcal{L}(\theta, \sigma, u\_s, m, \lambda, \nu) &= \frac{1}{2} \sum\_{s=1}^{n\_s} ||Pu\_s - d\_s||\_2^2 + \alpha \mathcal{R}(m, \theta, \sigma) \\ &+ \frac{\mu}{2} \sum\_{s=1}^{n\_s} ||A(m)u\_s - b\_s||\_2^2 - \lambda\_s^T (A(m)u\_s - b\_s) \\ &+ \frac{\tau}{2} ||\theta - z||\_2^2 - \nu^T(\theta - z), \end{aligned}$$

where z(0) = min(max(0, - %), }), and v are Lagrange multipliers associated to the constraints, and µ > 0 and T > 0 are the penalty parameters. The regularization parameter a > 0 is given, being typically determined by the discrepancy principle.

This problem can be efficiently solved using the alternating direction method of multipliers (ADMM, [15]), resulting in the following iterative procedure starting from initial guess m (typically encoding some prior information), (spatially invariant) σ = 0.5 and initial multipliers λς = v = 0:

$$\theta^{+} = \arg\min\_{\theta} \mathcal{L}(\theta, \sigma, u\_s, m, \lambda, \nu) \tag{8a}$$

$$
\sigma^{+} = \arg\min\_{\sigma} \mathcal{L}(\theta^{+}, \sigma, u\_{s}, m, \lambda, \nu) \tag{8b}
$$

$$u\_s^+ = \arg\min\_u \mathcal{L}(\theta^+, \sigma^+, u, m, \lambda, \nu) \tag{8c}$$

$$m^{+} = \arg\min\_{m} \mathcal{L}(\theta^{+}, \sigma^{+}, u\_{s}^{+}, m, \lambda, \nu) \tag{8d}$$

$$
\lambda\_s^+ = \lambda\_s - \mu(A(m^+)u\_s^+ - b\_s) \tag{8e}
$$

$$
\nu^+ = \nu - \tau(\theta^+ - z^+). \tag{8f}
$$

Here, the updated variables at each iteration are denoted by a superscript "+". Each step of the algorithm addresses a specific subproblem, as described more in details below.

Subproblem equation 8a involves minimizing the regularization function 7c, as defined in equation 4, with respect to 0, given the current values of m and o. This can can be efficiently achieved using a single iteration of the Gauss-Newton method. To ensure the stability of the 0 update, it is essential to incorporate a smoothing term, as suggested by [1].

Subproblem equation 8b involves minimizing R with respect to o, resulting in:

$$[\sigma]\_i = \frac{[g\_{z'}]\_i^2}{[g\_{x'}]\_i^2 + [g\_{z'}]\_i^2},\tag{9}$$

where ( (gx ]; ] g2 ]; } = R((0);)(Vm); represent the rotated gradient of the current model at the ith pixel. This expression for equation 9 is justified by considering that, when [0]; corresponds to the correct orientation angle, we typically expect [[gx] || < |[gx] i|. In this case, directly minimizing [gx]] + [gx]] would heavily penalize [gz] [;, which is undesirable because we aim to apply more smoothing along the direction defined by [0] in equation 9 balance the contributions of gradient components in the weighted sum [o] [gx]] + (1 - [0] ) [gx] , ensuring that the magnitudes of both terms are approximately equal before penalization. This adaptive weighting mechanism effectively enhances smoothing along the structural direction (0); while allowing variations across it, eventually enabling the recovery of dominating structures and details in the model m. To maintain stability during the o update, the computed weights are smoothed using a convolution with a 5 × 5 averaging filter; alternatively, one could incorporate a smoothing term.

A comprehensive analysis of the methods for solving subproblems equation 8d can be found in [14].